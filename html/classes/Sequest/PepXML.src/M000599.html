<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE html 
     PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html>
<head>
  <title>new_from_srf (Sequest::PepXML)</title>
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
  <link rel="stylesheet" href="../../.././rdoc-style.css" type="text/css" media="screen" />
</head>
<body class="standalone-code">
  <pre><span class="ruby-comment cmt"># File lib/spec_id/sequest/pepxml.rb, line 285</span>
  <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">new_from_srf</span>(<span class="ruby-identifier">srf</span>, <span class="ruby-identifier">opts</span>={})
    <span class="ruby-identifier">opts</span> = <span class="ruby-constant">Default_Options</span>.<span class="ruby-identifier">merge</span>(<span class="ruby-identifier">opts</span>)

    <span class="ruby-comment cmt">## read the srf file</span>
    <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">srf</span>.<span class="ruby-identifier">is_a?</span> <span class="ruby-constant">String</span>
      <span class="ruby-identifier">srf</span> = <span class="ruby-constant">SRF</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">srf</span>)
    <span class="ruby-keyword kw">end</span>

    <span class="ruby-comment cmt">## set the outpath</span>
    <span class="ruby-identifier">out_path</span> = <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">:out_path</span>)

    <span class="ruby-identifier">params</span> = <span class="ruby-identifier">srf</span>.<span class="ruby-identifier">params</span>

    <span class="ruby-comment cmt">## check to see if we need backup_db</span>
    <span class="ruby-identifier">backup_db_path</span> = <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">:backup_db_path</span>)
    <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-constant">File</span>.<span class="ruby-identifier">exist?</span>(<span class="ruby-identifier">params</span>.<span class="ruby-identifier">database</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">backup_db_path</span>
      <span class="ruby-identifier">params</span>.<span class="ruby-identifier">database_path</span> = <span class="ruby-identifier">backup_db_path</span>
    <span class="ruby-keyword kw">end</span>

    <span class="ruby-comment cmt">#######################################################################</span>
    <span class="ruby-comment cmt"># PREPARE THE OPTIONS:</span>
    <span class="ruby-comment cmt">#######################################################################</span>
    <span class="ruby-comment cmt">## remove items from the options hash that don't belong to </span>
    <span class="ruby-identifier">ppxml_version</span> = <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">:pepxml_version</span>)
    <span class="ruby-identifier">out_data_type</span> = <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">:out_data_type</span>)
    <span class="ruby-identifier">out_data</span> = <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">:out_data</span>)

    <span class="ruby-comment cmt">## Extract meta info from srf</span>
    <span class="ruby-identifier">bn_noext</span> = <span class="ruby-identifier">base_name_noext</span>(<span class="ruby-identifier">srf</span>.<span class="ruby-identifier">header</span>.<span class="ruby-identifier">raw_filename</span>)
    <span class="ruby-identifier">opts</span>[<span class="ruby-identifier">:ms_model</span>] = <span class="ruby-identifier">srf</span>.<span class="ruby-identifier">header</span>.<span class="ruby-identifier">model</span>
    <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">opts</span>[<span class="ruby-identifier">:ms_model</span>]
    <span class="ruby-keyword kw">when</span> <span class="ruby-regexp re">/Orbitrap/</span>
      <span class="ruby-identifier">opts</span>[<span class="ruby-identifier">:ms_mass_analyzer</span>] = <span class="ruby-value str">'Orbitrap'</span>
    <span class="ruby-keyword kw">when</span> <span class="ruby-regexp re">/LCQ Deca XP/</span>
      <span class="ruby-identifier">opts</span>[<span class="ruby-identifier">:ms_mass_analyzer</span>] = <span class="ruby-value str">'Ion Trap'</span>
    <span class="ruby-keyword kw">end</span>

    <span class="ruby-comment cmt">## Create the base name</span>
    <span class="ruby-identifier">full_base_name_no_ext</span> = <span class="ruby-identifier">make_base_name</span>( <span class="ruby-constant">File</span>.<span class="ruby-identifier">expand_path</span>(<span class="ruby-identifier">out_path</span>), <span class="ruby-identifier">bn_noext</span>)
    <span class="ruby-identifier">opts</span>[<span class="ruby-identifier">:base_name</span>] = <span class="ruby-identifier">full_base_name_no_ext</span>

    <span class="ruby-comment cmt">## Create the search summary:</span>
    <span class="ruby-identifier">search_summary_options</span> = {
      <span class="ruby-identifier">:search_database</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-constant">Sequest</span><span class="ruby-operator">::</span><span class="ruby-constant">PepXML</span><span class="ruby-operator">::</span><span class="ruby-constant">SearchDatabase</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">params</span>),
      <span class="ruby-identifier">:base_name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">full_base_name_no_ext</span>,
      <span class="ruby-identifier">:out_data_type</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">out_data_type</span>,
      <span class="ruby-identifier">:out_data</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">out_data</span>
    }
    <span class="ruby-identifier">modifications_string</span> = <span class="ruby-identifier">srf</span>.<span class="ruby-identifier">header</span>.<span class="ruby-identifier">modifications</span>
    <span class="ruby-identifier">search_summary</span> = <span class="ruby-constant">Sequest</span><span class="ruby-operator">::</span><span class="ruby-constant">PepXML</span><span class="ruby-operator">::</span><span class="ruby-constant">SearchSummary</span>.<span class="ruby-identifier">new</span>( <span class="ruby-identifier">params</span>, <span class="ruby-identifier">modifications_string</span>, <span class="ruby-identifier">search_summary_options</span>)

    <span class="ruby-comment cmt"># create the sample enzyme from the params object:</span>
    <span class="ruby-identifier">sample_enzyme_obj</span> = 
      <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">opts</span>[<span class="ruby-identifier">:sample_enzyme</span>]
        <span class="ruby-identifier">opts</span>[<span class="ruby-identifier">:sample_enzyme</span>]
      <span class="ruby-keyword kw">else</span>
        <span class="ruby-identifier">params</span>.<span class="ruby-identifier">sample_enzyme</span>
      <span class="ruby-keyword kw">end</span>
    <span class="ruby-identifier">opts</span>[<span class="ruby-identifier">:sample_enzyme</span>] = <span class="ruby-identifier">sample_enzyme_obj</span>

    <span class="ruby-comment cmt">## Create the pepxml obj and top level objects</span>
    <span class="ruby-identifier">pepxml_obj</span> = <span class="ruby-constant">Sequest</span><span class="ruby-operator">::</span><span class="ruby-constant">PepXML</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">ppxml_version</span>, <span class="ruby-identifier">params</span>) 
    <span class="ruby-identifier">pipeline</span> = <span class="ruby-constant">Sequest</span><span class="ruby-operator">::</span><span class="ruby-constant">PepXML</span><span class="ruby-operator">::</span><span class="ruby-constant">MSMSPipelineAnalysis</span>.<span class="ruby-identifier">new</span>({<span class="ruby-identifier">:date=</span><span class="ruby-operator">&gt;</span><span class="ruby-keyword kw">nil</span>,<span class="ruby-identifier">:summary_xml=</span><span class="ruby-operator">&gt;</span> <span class="ruby-identifier">bn_noext</span> <span class="ruby-operator">+</span><span class="ruby-value str">'.xml'</span>})
    <span class="ruby-identifier">pepxml_obj</span>.<span class="ruby-identifier">msms_pipeline_analysis</span> = <span class="ruby-identifier">pipeline</span>
    <span class="ruby-identifier">pipeline</span>.<span class="ruby-identifier">msms_run_summary</span> = <span class="ruby-constant">Sequest</span><span class="ruby-operator">::</span><span class="ruby-constant">PepXML</span><span class="ruby-operator">::</span><span class="ruby-constant">MSMSRunSummary</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">opts</span>)
    <span class="ruby-identifier">pipeline</span>.<span class="ruby-identifier">msms_run_summary</span>.<span class="ruby-identifier">search_summary</span> = <span class="ruby-identifier">search_summary</span>
    <span class="ruby-identifier">modifications_obj</span> = <span class="ruby-identifier">search_summary</span>.<span class="ruby-identifier">modifications</span>

    <span class="ruby-comment cmt">## name some common variables we'll need</span>
    <span class="ruby-identifier">h_plus</span> = <span class="ruby-identifier">pepxml_obj</span>.<span class="ruby-identifier">h_plus</span>
    <span class="ruby-identifier">avg_parent</span> = <span class="ruby-identifier">pepxml_obj</span>.<span class="ruby-identifier">avg_parent</span>


    <span class="ruby-comment cmt">## COPY MZXML FILES IF NECESSARY</span>
    <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">opts</span>[<span class="ruby-identifier">:copy_mzxml</span>]
      <span class="ruby-identifier">mzxml_pathname_noext</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-identifier">opts</span>[<span class="ruby-identifier">:ms_data</span>], <span class="ruby-identifier">bn_noext</span>)
      <span class="ruby-identifier">to_copy</span> = <span class="ruby-constant">MS</span><span class="ruby-operator">::</span><span class="ruby-constant">Converter</span><span class="ruby-operator">::</span><span class="ruby-constant">MzXML</span>.<span class="ruby-identifier">file_to_mzxml</span>(<span class="ruby-identifier">mzxml_pathname_noext</span>)
      <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">to_copy</span>
        <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">cp</span> <span class="ruby-identifier">to_copy</span>, <span class="ruby-identifier">out_path</span>
      <span class="ruby-keyword kw">else</span>
        <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;Couldn't file mzXML file with base: #{mzxml_pathname_noext}&quot;</span>
        <span class="ruby-identifier">puts</span> <span class="ruby-value str">&quot;Perhaps you need to specifiy the location of the raw data&quot;</span>
        <span class="ruby-identifier">puts</span> <span class="ruby-value str">&quot;or need an mzXML converter (readw or t2x)&quot;</span>
        <span class="ruby-identifier">exit</span>
      <span class="ruby-keyword kw">end</span>
    <span class="ruby-keyword kw">end</span>


    <span class="ruby-comment cmt">#######################################################################</span>
    <span class="ruby-comment cmt"># CREATE the spectrum_queries_ar</span>
    <span class="ruby-comment cmt">#######################################################################</span>
    <span class="ruby-identifier">srf_index</span> = <span class="ruby-identifier">srf</span>.<span class="ruby-identifier">index</span>
    <span class="ruby-identifier">out_files</span> = <span class="ruby-identifier">srf</span>.<span class="ruby-identifier">out_files</span>
    <span class="ruby-identifier">spectrum_queries_arr</span> = <span class="ruby-constant">Array</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">srf</span>.<span class="ruby-identifier">dta_files</span>.<span class="ruby-identifier">size</span>)
    <span class="ruby-identifier">files_with_hits_index</span> = <span class="ruby-value">0</span>  <span class="ruby-comment cmt">## will end up being 1 indexed</span>

    <span class="ruby-identifier">deltacn_orig</span> = <span class="ruby-identifier">opts</span>[<span class="ruby-identifier">:deltacn_orig</span>]
    <span class="ruby-identifier">deltacn_index</span> = 
      <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">deltacn_orig</span> ; <span class="ruby-value">20</span>
      <span class="ruby-keyword kw">else</span> <span class="ruby-value">19</span>
      <span class="ruby-keyword kw">end</span>

    <span class="ruby-identifier">srf</span>.<span class="ruby-identifier">dta_files</span>.<span class="ruby-identifier">each_with_index</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">dta_file</span>,<span class="ruby-identifier">dta_i</span><span class="ruby-operator">|</span>
      <span class="ruby-keyword kw">next</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">out_files</span>[<span class="ruby-identifier">dta_i</span>].<span class="ruby-identifier">num_hits</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span>
      <span class="ruby-identifier">files_with_hits_index</span> <span class="ruby-operator">+=</span> <span class="ruby-value">1</span>

      <span class="ruby-identifier">precursor_neutral_mass</span> = <span class="ruby-identifier">dta_file</span>.<span class="ruby-identifier">mh</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">h_plus</span>

      (<span class="ruby-identifier">start_scan</span>, <span class="ruby-identifier">end_scan</span>, <span class="ruby-identifier">charge</span>) = <span class="ruby-identifier">srf_index</span>[<span class="ruby-identifier">dta_i</span>]
      <span class="ruby-identifier">sq_hash</span> = {
        <span class="ruby-identifier">:spectrum</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-identifier">bn_noext</span>, <span class="ruby-identifier">start_scan</span>, <span class="ruby-identifier">end_scan</span>, <span class="ruby-identifier">charge</span>].<span class="ruby-identifier">join</span>(<span class="ruby-value str">'.'</span>),
        <span class="ruby-identifier">:start_scan</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">start_scan</span>,
        <span class="ruby-identifier">:end_scan</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">end_scan</span>,
        <span class="ruby-identifier">:precursor_neutral_mass</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">precursor_neutral_mass</span>,
        <span class="ruby-identifier">:assumed_charge</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">charge</span>.<span class="ruby-identifier">to_i</span>,
        <span class="ruby-identifier">:pepxml_version</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">ppxml_version</span>,
        <span class="ruby-identifier">:index</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">files_with_hits_index</span>,
      }

      <span class="ruby-identifier">spectrum_query</span> = <span class="ruby-constant">Sequest</span><span class="ruby-operator">::</span><span class="ruby-constant">PepXML</span><span class="ruby-operator">::</span><span class="ruby-constant">SpectrumQuery</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">sq_hash</span>)


      <span class="ruby-identifier">hits</span> = <span class="ruby-identifier">out_files</span>[<span class="ruby-identifier">dta_i</span>].<span class="ruby-identifier">hits</span>

      <span class="ruby-identifier">search_hits</span> = 
        <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">opts</span>[<span class="ruby-identifier">:all_hits</span>]
          <span class="ruby-constant">Array</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">out_files</span>[<span class="ruby-identifier">dta_i</span>].<span class="ruby-identifier">num_hits</span>)  <span class="ruby-comment cmt"># all hits</span>
        <span class="ruby-keyword kw">else</span>
          <span class="ruby-constant">Array</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">1</span>)  <span class="ruby-comment cmt"># top hit only</span>
        <span class="ruby-keyword kw">end</span>

      (<span class="ruby-value">0</span><span class="ruby-operator">...</span>(<span class="ruby-identifier">search_hits</span>.<span class="ruby-identifier">size</span>)).<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">hit_i</span><span class="ruby-operator">|</span>
        <span class="ruby-identifier">hit</span> = <span class="ruby-identifier">hits</span>[<span class="ruby-identifier">hit_i</span>]
        <span class="ruby-comment cmt"># under the modified deltacn schema (like bioworks)</span>
        <span class="ruby-comment cmt"># Get proper deltacn and deltacnstar</span>
        <span class="ruby-comment cmt"># under new srf, deltacn is already corrected for what prophet wants,</span>
        <span class="ruby-comment cmt"># deltacn_orig_updated is how to access the old one</span>
        <span class="ruby-comment cmt"># Prophet deltacn is not the same as the native Sequest deltacn</span>
        <span class="ruby-comment cmt"># It is the deltacn of the second best hit!</span>

        <span class="ruby-comment cmt">## mass calculations:</span>
        <span class="ruby-identifier">calc_neutral_pep_mass</span> = <span class="ruby-identifier">hit</span>[<span class="ruby-value">0</span>] <span class="ruby-operator">-</span> <span class="ruby-identifier">h_plus</span>


        <span class="ruby-identifier">sequence</span> = <span class="ruby-identifier">hit</span>.<span class="ruby-identifier">sequence</span>

        <span class="ruby-comment cmt">#  NEED TO MODIFY SPLIT SEQUENCE TO DO MODS!</span>
        <span class="ruby-comment cmt">## THIS IS ALL INNER LOOP, so we make every effort at speed here:</span>
        (<span class="ruby-identifier">prevaa</span>, <span class="ruby-identifier">pepseq</span>, <span class="ruby-identifier">nextaa</span>) = <span class="ruby-constant">SpecID</span><span class="ruby-operator">::</span><span class="ruby-constant">Pep</span>.<span class="ruby-identifier">prepare_sequence</span>(<span class="ruby-identifier">sequence</span>)
        <span class="ruby-comment cmt"># 0=mh 1=deltacn_orig 2=sp 3=xcorr 4=id 5=num_other_loci 6=rsp 7=ions_matched 8=ions_total 9=sequence 10=prots 11=deltamass 12=ppm 13=aaseq 14=base_name 15=first_scan 16=last_scan 17=charge 18=srf 19=deltacn 20=deltacn_orig_updated</span>

        <span class="ruby-identifier">sh_hash</span> = {
          <span class="ruby-identifier">:hit_rank</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">hit_i</span><span class="ruby-operator">+</span><span class="ruby-value">1</span>,
          <span class="ruby-identifier">:peptide</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">pepseq</span>,
          <span class="ruby-identifier">:peptide_prev_aa</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">prevaa</span>,
          <span class="ruby-identifier">:peptide_next_aa</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">nextaa</span>,
          <span class="ruby-identifier">:protein</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">hit</span>[<span class="ruby-value">10</span>].<span class="ruby-identifier">first</span>.<span class="ruby-identifier">reference</span>.<span class="ruby-identifier">split</span>(<span class="ruby-value str">&quot; &quot;</span>).<span class="ruby-identifier">first</span>, 
          <span class="ruby-identifier">:num_tot_proteins</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">hit</span>[<span class="ruby-value">10</span>].<span class="ruby-identifier">size</span>,
          <span class="ruby-identifier">:num_matched_ions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">hit</span>[<span class="ruby-value">7</span>],
          <span class="ruby-identifier">:tot_num_ions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">hit</span>[<span class="ruby-value">8</span>],
          <span class="ruby-identifier">:calc_neutral_pep_mass</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">calc_neutral_pep_mass</span>,
          <span class="ruby-identifier">:massdiff</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">precursor_neutral_mass</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">calc_neutral_pep_mass</span>, 
          <span class="ruby-identifier">:num_tol_term</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">sample_enzyme_obj</span>.<span class="ruby-identifier">num_tol_term</span>(<span class="ruby-identifier">sequence</span>),
          <span class="ruby-identifier">:num_missed_cleavages</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">sample_enzyme_obj</span>.<span class="ruby-identifier">num_missed_cleavages</span>(<span class="ruby-identifier">pepseq</span>),
          <span class="ruby-identifier">:is_rejected</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>,
          <span class="ruby-comment cmt"># These are search score attributes:</span>
          <span class="ruby-identifier">:xcorr</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">hit</span>[<span class="ruby-value">3</span>],
          <span class="ruby-identifier">:deltacn</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">hit</span>[<span class="ruby-identifier">deltacn_index</span>],
          <span class="ruby-identifier">:spscore</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">hit</span>[<span class="ruby-value">2</span>],
          <span class="ruby-identifier">:sprank</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">hit</span>[<span class="ruby-value">6</span>],
          <span class="ruby-identifier">:modification_info</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">modifications_obj</span>.<span class="ruby-identifier">modification_info</span>(<span class="ruby-constant">SpecID</span><span class="ruby-operator">::</span><span class="ruby-constant">Pep</span>.<span class="ruby-identifier">split_sequence</span>(<span class="ruby-identifier">sequence</span>)[<span class="ruby-value">1</span>]),
        }
        <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">deltacn_orig</span>
          <span class="ruby-identifier">sh_hash</span>[<span class="ruby-identifier">:deltacnstar</span>] = 
            <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">hits</span>[<span class="ruby-identifier">hit_i</span><span class="ruby-operator">+</span><span class="ruby-value">1</span>].<span class="ruby-identifier">nil?</span>  <span class="ruby-comment cmt"># no next hit? then its deltacnstar == 1</span>
            <span class="ruby-value str">'1'</span>
            <span class="ruby-keyword kw">else</span>
            <span class="ruby-value str">'0'</span>
            <span class="ruby-keyword kw">end</span>
        <span class="ruby-keyword kw">end</span>
        <span class="ruby-identifier">search_hits</span>[<span class="ruby-identifier">hit_i</span>] = <span class="ruby-constant">Sequest</span><span class="ruby-operator">::</span><span class="ruby-constant">PepXML</span><span class="ruby-operator">::</span><span class="ruby-constant">SearchHit</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">sh_hash</span>) <span class="ruby-comment cmt"># there can be multiple hits</span>
      <span class="ruby-keyword kw">end</span>

      <span class="ruby-identifier">search_result</span> = <span class="ruby-constant">Sequest</span><span class="ruby-operator">::</span><span class="ruby-constant">PepXML</span><span class="ruby-operator">::</span><span class="ruby-constant">SearchResult</span>.<span class="ruby-identifier">new</span>
      <span class="ruby-identifier">search_result</span>.<span class="ruby-identifier">search_hits</span> = <span class="ruby-identifier">search_hits</span>
      <span class="ruby-identifier">spectrum_query</span>.<span class="ruby-identifier">search_results</span> = [<span class="ruby-identifier">search_result</span>]
      <span class="ruby-identifier">spectrum_queries_arr</span>[<span class="ruby-identifier">files_with_hits_index</span>] = <span class="ruby-identifier">spectrum_query</span>
    <span class="ruby-keyword kw">end</span>
    <span class="ruby-identifier">spectrum_queries_arr</span>.<span class="ruby-identifier">compact!</span>

    <span class="ruby-identifier">pipeline</span>.<span class="ruby-identifier">msms_run_summary</span>.<span class="ruby-identifier">spectrum_queries</span> = <span class="ruby-identifier">spectrum_queries_arr</span> 
    <span class="ruby-identifier">pepxml_obj</span>.<span class="ruby-identifier">base_name</span> = <span class="ruby-identifier">pipeline</span>.<span class="ruby-identifier">msms_run_summary</span>.<span class="ruby-identifier">base_name</span>
    <span class="ruby-identifier">pipeline</span>.<span class="ruby-identifier">msms_run_summary</span>.<span class="ruby-identifier">spectrum_queries</span> =  <span class="ruby-identifier">spectrum_queries_arr</span> 

    <span class="ruby-identifier">pepxml_obj</span>
  <span class="ruby-keyword kw">end</span></pre>
</body>
</html>